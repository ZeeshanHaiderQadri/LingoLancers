<!DOCTYPE html>
<html>
<head>
    <title>Connection Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        button { padding: 10px 20px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background-color: #0056b3; }
        pre { background-color: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>API Connection Test</h1>
    <button onclick="testConnection()">Test Connection</button>
    <div id="results"></div>

    <script>
        async function testConnection() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="test-result">Testing connection...</div>';
            
            try {
                // Test 1: Health check
                const healthResponse = await fetch('http://localhost:8001/health');
                const healthData = await healthResponse.json();
                
                let resultHTML = `
                    <div class="test-result success">
                        <h3>✅ Health Check Passed</h3>
                        <pre>${JSON.stringify(healthData, null, 2)}</pre>
                    </div>
                `;
                
                // Test 2: Task creation
                const taskResponse = await fetch('http://localhost:8001/tasks', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_id: 'frontend_test',
                        request: 'Plan a trip to Paris for 5 days',
                        team: 'travel_planning'
                    })
                });
                
                if (taskResponse.ok) {
                    const taskData = await taskResponse.json();
                    resultHTML += `
                        <div class="test-result success">
                            <h3>✅ Task Creation Passed</h3>
                            <pre>${JSON.stringify(taskData, null, 2)}</pre>
                        </div>
                    `;
                    
                    // Test 3: Task status check
                    const statusResponse = await fetch(`http://localhost:8001/tasks/${taskData.task_id}`);
                    if (statusResponse.ok) {
                        const statusData = await statusResponse.json();
                        resultHTML += `
                            <div class="test-result success">
                                <h3>✅ Task Status Check Passed</h3>
                                <pre>${JSON.stringify(statusData, null, 2)}</pre>
                            </div>
                        `;
                    } else {
                        resultHTML += `
                            <div class="test-result error">
                                <h3>❌ Task Status Check Failed</h3>
                                <p>Status: ${statusResponse.status}</p>
                            </div>
                        `;
                    }
                } else {
                    const errorText = await taskResponse.text();
                    resultHTML += `
                        <div class="test-result error">
                            <h3>❌ Task Creation Failed</h3>
                            <p>Status: ${taskResponse.status}</p>
                            <p>Error: ${errorText}</p>
                        </div>
                    `;
                }
                
                resultsDiv.innerHTML = resultHTML;
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="test-result error">
                        <h3>❌ Connection Test Failed</h3>
                        <p>Error: ${error.message}</p>
                        <p>Please check that all services are running on the correct ports:</p>
                        <ul>
                            <li>Frontend: http://localhost:3000</li>
                            <li>Main Backend API: http://localhost:8000</li>
                            <li>Lingo Master API: http://localhost:8001</li>
                        </ul>
                    </div>
                `;
                console.error(error);
            }
        }
    </script>
</body>
</html>